{% extends "nogoff/base.html" %}
{% load nog_tags %}

{% block body %}
<div class="nog-card">
    <p>Hello {{user}}</p>
    <div class="event-card-header">
        <div class="event-title">{{ nogoff.name }}</div>
        <div class="event-datetime">
            {{ nogoff.event_date|date:"F j, Y" }}<br>
            {{ nogoff.start_time|time:"gA" }} - {{ nogoff.end_time|time:"gA" }}
        </div>
    </div>
    <h3 style="margin-top:2rem;">Nog Votes {% if user.has_voted %} - You have already voted{% endif %}</h3>
    <div class="errors"></div>
    {% if user.has_voted %} <button id="reset-votes" class="material-btn reset-btn">Reset Votes</button> {% endif %}
    <form class="nog-form" data-nvotes="{{n_votes}}" action="{% url 'vote' nogoff.id%}" method="post" >
        {% csrf_token %}
        {% for nog in nogs %}
        <div class="nog-vote-group">
            <label>{{ nog.number }}</label>
            <div class="vote-input-group">
                <button type="button" class="vote-btn" data-action="decrement" aria-label="Decrement" {% if user.has_voted %}disabled{% endif %}>-</button>
                <input 
                    type="number" 
                    name="{{ nog.id }}" 
                    min="0" 
                    {% if user.has_voted %}
                        value="{% get_votes_by_user_event nog user nogoff %}"
                    {% else %}
                        value="0"
                    {% endif %}  
                />
                <button type="button" class="vote-btn" data-action="increment" aria-label="Increment" {% if user.has_voted %}disabled{% endif %}>+</button>
            </div>
        </div>
        {% endfor %}

        <input 
          type="submit" 
          value="Vote" 
          class="material-btn" 
          {% if user.has_voted %} disabled {% endif %}
        />
    </form>
    <!-- Success Modal -->
    <div id="voteSuccessModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ðŸŽ‰ Vote Recorded!</h2>
            </div>
            <div class="modal-body">
                <p>Thank you for participating in democracy! Your votes have been recorded and you're now free to enjoy the NogOff festivities.</p>
                <p>May the best nog win! ðŸŽ„</p>
            </div>
            <div class="modal-footer">
                <button class="material-btn" onclick="window.location.reload()">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}