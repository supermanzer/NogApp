{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<style>
    .nog-votes-table {
        width: 100%;
        margin: 1em 0;
        border-collapse: collapse;
    }
    .nog-votes-table th,
    .nog-votes-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    .nog-votes-table th {
        background-color: #f5f5f5;
    }
    .nog-votes-table tr:hover {
        background-color: #f9f9f9;
    }
    .vote-count {
        font-weight: bold;
        color: #2e7d32;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        function refreshVotes() {
            const tableContainer = document.getElementById('nog-votes-container');
            if (!tableContainer) return;
            
            const eventId = document.querySelector('input[name="object_id"]').value;
            fetch(`/admin/nogoff/event/${eventId}/nog-votes/`)
                .then(response => response.json())
                .then(data => {
                    const table = document.createElement('table');
                    table.className = 'nog-votes-table';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Nog Number</th>
                                <th>Creator</th>
                                <th>Description</th>
                                <th>Vote Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.nogs.map(nog => `
                                <tr>
                                    <td>${nog.number}</td>
                                    <td>${nog.creator}</td>
                                    <td>${nog.description}</td>
                                    <td class="vote-count">${nog.vote_count}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    `;
                    tableContainer.innerHTML = '';
                    tableContainer.appendChild(table);
                })
                .catch(error => console.error('Error fetching votes:', error));
        }

        // Initial load
        refreshVotes();
        // Refresh every 30 seconds
        setInterval(refreshVotes, 30000);
    });
</script>
{% endblock %}

{% block after_field_sets %}
{{ block.super }}
<h2>Nog Votes</h2>
<div id="nog-votes-container"></div>
{% endblock %}